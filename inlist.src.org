# - Reference from [[associate-id:org:j6vjf5c0mnj0][inList]] on [2022-11-26 Sat 17:26]

#+title: inlist
#+author: Stas Vlasov
#+r_package_version: 
#+r_package_url:
#+r_package_bug_reports:

* Description
:PROPERTIES:
:export_file_name: README.md
:export_options: toc:nil
:export_options+: author:nil
:export_options+: title:nil
:ID:       org:ewu1cyq0yij0
:END:

#+begin: md-badges :codecove-token nil
#+end

** Installation

#+BEGIN_SRC R :noweb yes
  devtools::install_github("<<github-repo()>>")
#+END_SRC


* R Code
#+BEGIN_SRC R :tangle R/inlist.r
  inlist <- function(l, extractor, selector) {
      parent_frame <- parent.frame()
      .eval <- \(envir, expr, call = `(`, fallback = NULL) {
          ## `(` is identity function
          if(
              all.vars(expr) |>
              sapply(\(v) eval(bquote(exists(.(v))), envir, parent_frame)) |>
              all()
          ) {
              do.call(call, list(eval(expr, envir, parent_frame)))
          } else {
              return(fallback)
          }
      }
      sys_call <- sys.call()
      ## filter
      extractor <- sys_call[[2]]
      extract_l <- sapply(l, .eval, extractor, isTRUE, FALSE)
      ## map
      selector <- sys_call[[3]]
      select_l <- lapply(l[extract_l], .eval, selector, list)
      ## return()
      Filter(Negate(is.null), select_l) |>
          lapply(unlist, recursive = FALSE)
  }
#+END_SRC
